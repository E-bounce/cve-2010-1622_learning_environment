FROM maven:3.2.3-jdk-8u40
COPY ./ /usr/src
LABEL maintainer="ebounce"
RUN cd /usr/src; \
    mvn -U clean package -Dmaven.test.skip=true -Dfile.encoding=UTF-8 -Dmaveb.artiface.threads=10
RUN apt-get update && apt-get install curl unzip; \
    mkdir /usr/local/tempdata && cd /usr/local/tempdata; \
    curl -O https://archive.apache.org/dist/tomcat/tomcat-6/v6.0.26/bin/apache-tomcat-6.0.26.zip; \
    unzip apache-tomcat-6.0.26.zip; \
    mv apache-tomcat-6.0.26 /usr/local/tomcat; \
    cd /usr/local/tomcat;\
    chmod +x ./bin/*.sh; \
    rm -rf /usr/local/tomcat/webapps/*; \
    cp /usr/src/target/cve10-1.0-SNAPSHOT.war /usr/local/tomcat/webapps/ROOT.war;
WORKDIR /usr/local/tomcat
ENV CATALINA_HOME=/usr/local/tomcat
ENV PATH=/usr/local/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
EXPOSE 8080/tcp
CMD ["catalina.sh","run"]